---
// Import Slick and jQuery
import 'slick-carousel/slick/slick.css';
import 'slick-carousel/slick/slick-theme.css';
import LogoShape from "../../../public/Vivrithi_logo.svg";

import { GRAPHQL } from "../../config/graphql.js";

const newsQuery = `{
  news(first: 4) {
    nodes {
      id
      title
      slug
      content
      date
      featuredImage { node { sourceUrl } }
      newsCategories { nodes { id name slug } }
    }
  }
}`;

let latestNews = [];

try {
  const res = await fetch(GRAPHQL, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ query: newsQuery }),
  });
  const data = await res.json();
  latestNews = data.data.news.nodes;
} catch (err) {
  console.error("Failed to fetch news:", err);
}

latestNews.sort((a, b) => new Date(b.date) - new Date(a.date));

function getReadingTime(htmlContent) {
  if (!htmlContent) return "1 min read";
  const text = htmlContent.replace(/<[^>]*>/g, "").trim();
  const words = text.split(/\s+/).length;
  const wordsPerMinute = 200;
  const minutes = Math.max(1, Math.ceil(words / wordsPerMinute));
  return `${minutes} min read`;
}
---
<div class="bg-white w-full md:py-[70px] py-[40px] pb-14">
  <div data-reveal class="fade-up container mx-auto px-4 lg:px-8 xl:px-4">
  <div class="flex flex-wrap md:items-center items-start">
    <div class="w-full md:w-1/2 md:pr-12 flex items-center p-0">
      <!-- Column 1 content -->
      <div>
<h2 class="text-[28px] md:text-[35px] md:text-4xl font-heading leading-[120%] mb-4 gradient-text">
      Vivriti in action:<br/>
from milestones to<br/>market moves
    </h2>
    <p class="max-w-3xl mb-12 leading-[24px]">      
      Explore our press releases, media releases, and media kit featuring Vivriti's milestones, strategic partnerships, product launches, and industry innovations. Stay informed about the developments shaping our journey forward.
    </p>
      </div>
    </div>
    <div class="w-full flex md:w-1/2 ">
   


 
<div class="slider-container milestones">
  <div class="slick-slider">
    {latestNews.map((post) => {
      const readTime = getReadingTime(post.content);
      return (
        <div class="slide" key={post.id}>
          <a href={`/news/${post.slug}`}>
          <img src={post.featuredImage?.node?.sourceUrl || "/blo_thumb.png"} alt={post.title} />
          <div class="overlay">
            <span class="uppercase text-[18px]">{post.newsCategories?.nodes?.[0]?.name || "Uncategorized"}</span>
            <p class="sm:pt-[10px] pt-1 leading-[18px] sm:leading-[24px]">
              {
                post.title
                  ? post.title.length > 300
                    ? post.title.substring(0, 300) + "..."
                    : post.title
                  : ""
              }
            </p>
            <span class="blog_date sm:pt-[17px] pt-1 flex gap-2 text-sm items-center">
              <svg width="12" height="12" viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M6 0C4.40887 0 2.88274 0.632146 1.75707 1.75707C0.632078 2.88261 0 4.40887 0 6C0 7.59113 0.632146 9.11726 1.75707 10.2429C2.88261 11.3679 4.40887 12 6 12C7.59113 12 9.11726 11.3679 10.2429 10.2429C11.3679 9.11739 12 7.59113 12 6C11.9984 4.40942 11.3657 2.88425 10.2407 1.75927C9.11575 0.634286 7.59058 0.00164571 6 0ZM6 11.1429C4.63607 11.1429 3.32791 10.6013 2.36352 9.63648C1.39869 8.6722 0.857143 7.36402 0.857143 6C0.857143 4.63598 1.39875 3.32791 2.36352 2.36352C3.3278 1.39869 4.63598 0.857143 6 0.857143C7.36402 0.857143 8.67209 1.39875 9.63648 2.36352C10.6013 3.3278 11.1429 4.63598 11.1429 6C11.1412 7.36339 10.5991 8.67058 9.63483 9.63483C8.67056 10.5991 7.36347 11.1412 6 11.1429ZM6.42857 2.14286V5.6448C6.42964 5.98605 6.29411 6.31337 6.05196 6.55391L4.16035 8.44552V8.44605C3.99213 8.60838 3.72481 8.6057 3.55928 8.4407C3.39429 8.27516 3.3916 8.00785 3.55392 7.83963L5.44554 5.94802H5.44607C5.52643 5.86766 5.57143 5.75837 5.57143 5.64481V2.14286C5.57143 1.90607 5.76321 1.71429 6 1.71429C6.23679 1.71429 6.42857 1.90607 6.42857 2.14286Z" fill="white"/>
              </svg>
              {new Date(post.date).toLocaleDateString("en-US", { weekday: 'long', day: 'numeric', month: 'short' })} | {readTime}
            </span>
          </div>
          </a>
        </div>
      );
    })}
  </div>
</div>


    </div>
  </div>
</div>
</div>
<style>

</style>
<script>
  import $ from "jquery";
  import "slick-carousel";

  document.addEventListener("DOMContentLoaded", () => {
    const $slider = $(".slick-slider");

    $slider.on("init", function (event, slick) {
      // Animate first slide on init
      const $currentSlide = $(slick.$slides[slick.currentSlide]);
      animateOverlay($currentSlide);
    });

    $slider.on("beforeChange", function (event, slick, currentSlide, nextSlide) {
      const $nextSlide = $(slick.$slides[nextSlide]);
      // Reset animations before next slide
      $(".overlay span, .overlay p, .overlay .blog_date").removeClass("animate");
      setTimeout(() => animateOverlay($nextSlide), 300);
    });

    $slider.slick({
  dots: true,
  arrows: false, // desktop hides arrows
  infinite: true, // autoplay infinite continues
  speed: 600,
  slidesToShow: 1,
  slidesToScroll: 1,
  autoplay: true,
  autoplaySpeed: 3500,
  fade: true,
  cssEase: "ease-in-out",

  nextArrow: `
    <button type="button" class="slick-next custom-arrow">
      <svg xmlns="http://www.w3.org/2000/svg" width="44" height="12" viewBox="0 0 44 12" fill="none">
        <path d="M43.5987 5.05444C43.8915 5.35073 43.8915 5.82561 43.5987 6.1151L38.826 10.8327C38.5331 11.1222 38.0583 11.1166 37.7654 10.8204C37.4725 10.5241 37.4725 10.0492 37.7654 9.75969L42.0078 5.5663L37.7654 1.27441C37.4725 0.978116 37.4725 0.503243 37.7654 0.21375C38.0583 -0.0757439 38.5331 -0.0702313 38.826 0.226062L43.5987 5.05444ZM-0.000825914 5.07861L-0.000825914 4.32861L43.0684 4.82861L43.0684 5.57861L43.0684 6.32861L-0.000825914 5.82861L-0.000825914 5.07861Z" fill="#666666"/>
      </svg>
    </button>
  `,

  prevArrow: `
    <button type="button" class="slick-prev custom-arrow">
      <svg xmlns="http://www.w3.org/2000/svg" width="44" height="12" viewBox="0 0 44 12" fill="none" style="transform:rotate(180deg)">
        <path d="M43.5987 5.05444C43.8915 5.35073 43.8915 5.82561 43.5987 6.1151L38.826 10.8327C38.5331 11.1222 38.0583 11.1166 37.7654 10.8204C37.4725 10.5241 37.4725 10.0492 37.7654 9.75969L42.0078 5.5663L37.7654 1.27441C37.4725 0.978116 37.4725 0.503243 37.7654 0.21375C38.0583 -0.0757439 38.5331 -0.0702313 38.826 0.226062L43.5987 5.05444ZM-0.000825914 5.07861L-0.000825914 4.32861L43.0684 4.82861L43.0684 5.57861L43.0684 6.32861L-0.000825914 5.82861L-0.000825914 5.07861Z" fill="#666666"/>
      </svg>
    </button>
  `,

  responsive: [
    {
      breakpoint: 768,
      settings: {
        arrows: true,
        dots: false
      }
    }
  ]
});



$slider.on("afterChange", function(event, slick, current){
  const $prev = $(".slick-prev svg path");
  const $next = $(".slick-next svg path");

  if (current === 0) {
    $prev.css("opacity", 0.3);
    $prev.css("pointer-events", "none");
  } else {
    $prev.css("opacity", 1);
    $prev.css("pointer-events", "auto");
  }

  if (current === slick.slideCount - 1) {
    $next.css("opacity", 0.3);
    $next.css("pointer-events", "none");
  } else {
    $next.css("opacity", 1);
    $next.css("pointer-events", "auto");
  }
});


    function animateOverlay($slide) {
      const $overlay = $slide.find(".overlay");
      const $elements = $overlay.find("span, p, .blog_date");
      $elements.each((index, el) => {
        setTimeout(() => {
          $(el).addClass("animate");
        }, index * 200); // stagger each element by 200ms
      });
    }
  });
</script>

<style>
.contact_cta2{
    padding: 10px 30px;
    display: flex;
    font-size: 14px;
}
.slider-container {
  position: relative;
  width: 100%;
  max-width: 900px;
  margin: auto;
}

.logo_in_slide{
  width: 40px!important;
  height: 40px!important;
  position: absolute;
  right: 20px;
  top: 20px;
}

.slide {
  position: relative;
}

.slide img {
  width: 100%;
  height: auto;
  display: block;
}

.overlay {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  display: flex;
  flex-direction: column;
  justify-content: flex-end;
  color: #fff;
  background: #000000;
  background: linear-gradient(187deg, rgba(0, 0, 0, 0) 42%, rgba(0, 0, 0, 1) 100%);
  transition: opacity 0.3s ease-in-out;
  padding: 45px;
}

.slide:hover .overlay {
  opacity: 1;
}

.overlay h2 {
  font-size: 2rem;
  margin-bottom: 0.5rem;
}

.overlay p {
  font-size: 1rem;
}

.overlay {
  position: absolute;
  top: 0; left: 0; right: 0; bottom: 0;
  display: flex;
  flex-direction: column;
  justify-content: flex-end;
  color: #fff;
  background: #000000;
  background: linear-gradient(187deg, rgba(0, 0, 0, 0) 45%, rgba(0, 0, 0, 1) 100%);
  padding: 45px;
  overflow: hidden;
}

/* Animation starting state */
.overlay span,
.overlay p,
.overlay .blog_date {
  opacity: 0;
  transform: translateY(30px);
  transition: all 0.6s ease-out;
}

/* When slide becomes active */
.overlay span.animate,
.overlay p.animate,
.overlay .blog_date.animate {
  opacity: 1;
  transform: translateY(0);
}
@media (max-width: 991px) {
  .overlay {
    padding: 30px;
  }
}

@media (max-width: 575px) {
  .overlay {
    padding: 20px;
  }
}
</style>

<style is:global>
/* Disable Slick default arrow icons */
.slick-prev:before,
.slick-next:before {
  display: none !important;
}

/* Mobile Only */
@media (max-width: 768px) {

  .milestones .slick-prev,
  .milestones .slick-next {
    position: absolute;
    bottom: -30px;
    top:initial;
    background: none;
    border: none;
    width: 44px;
    height: 20px;
    z-index: 9999;
  }

  /* Position arrows at center */
  .milestones .slick-prev {
    left: 50%;
    transform: translateX(-60px);
  }

  .milestones .slick-next {
    left: 50%;
    transform: translateX(10px);
  }

  .milestones .custom-arrow svg {
    width: 44px;
    height: 12px;
  }
}
</style>