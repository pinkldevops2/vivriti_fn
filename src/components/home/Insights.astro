---
import LogoShape from "../../../public/Vivrithi_logo.svg";
import { GRAPHQL } from "../../config/graphql.js";
const { nonce } = Astro.locals;
let blogPosts = [];

const blogQuery = `{
  posts(first: 4) {
    nodes {
      id
      title
      slug
      date
      blog {
        description
        uploadPdf {
          node {
            mediaItemUrl
            mimeType
          }
        }
      }
      featuredImage {
        node {
          sourceUrl
        }
      }
      categories {
        edges {
          node {
            id
            name
            slug
          }
        }
      }
    }
  }
}`;

try {
  const res = await fetch(GRAPHQL, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ query: blogQuery }),
  });
  const data = await res.json();
  blogPosts = data.data.posts.nodes;
} catch (err) {
  console.error("Error fetching blog posts:", err);
}
function getReadingTime(htmlContent) {
  if (!htmlContent) return "1 min read";
  const text = htmlContent.replace(/<[^>]*>/g, "").trim();
  const words = text.split(/\s+/).length;
  const wordsPerMinute = 200;
  const minutes = Math.max(1, Math.ceil(words / wordsPerMinute));
  return `${minutes} min read`;
}
const featuredPost = blogPosts?.[0];
const pdfUrl = featuredPost.blog?.uploadPdf?.node?.mediaItemUrl;
const detailUrl = `/blog/${featuredPost.slug}`; 

const link = pdfUrl ? pdfUrl : detailUrl;
---

<div
  class="bg-[#3bbae212] w-full md:pt-[70px] sm:pb-[40px] pt-[40px]"
>
  <div class="container mx-auto px-4 lg:px-8 xl:px-4">
    <div class="flex flex-wrap justify-between">
      <div
        class="w-full md:w-4/12 lg:w-2/12 flex flex-col items-start justify-center mb-4 sm:mb-0"
      >
        <h2
          class="text-[30px] md:text-4xl font-heading leading-[42px] mb-4 gradient-text tracking-[-1px]"
        >
          Vivriti Think Tank: Shaping the future of finance
        </h2>
        <p class="pt-3">
          Our articles, reports, podcasts, videos, events, webinars, and search archives bring you expert insights, market updates, and dynamic perspectives to help you stay up-to-date and ahead of the game.
        </p>
        <a
          href="/blog"
          class="contact_cta contact_cta2 mt-4 flex items-center gap-2 text-white uppercase hover:text-blue-600 transition mb-2"
          ><span data-text="View more"> View more</span>
          <img src={LogoShape.src} alt="Vivrithi" class="w-5 h-5" />
        </a>
      </div>



      <div data-reveal class="fade-up hidden sm:block w-full md:w-8/12 lg:w-5/12">
  {featuredPost && (
    <div>
      <!-- Image -->
      <div class="image-flash-container">
      <a href={link}> <img
          src={featuredPost.featuredImage?.node?.sourceUrl || "/Insights.png"}
          alt={featuredPost.title}
        /></a>
      </div>

      <div class="pt-[25px]">
        <!-- Category + Read time -->
        <span class="taxonomy_tag gradient-text text-sm">
          {featuredPost.categories?.edges?.[0]?.node?.name || "Report"} |
          {getReadingTime(featuredPost.blog?.description)}
        </span>

        <!-- Description -->
        <p class="max-w-3xl pt-[20px] leading-[24px] text-[#1B1B1B] text-lg">
          <a href={link}>{featuredPost?.title}</a>
        </p>

        <!-- Date -->
        <span class="taxonomy_date flex text-sm items-center gap-2 pt-[10px]">
          <svg width="12" height="12" viewBox="0 0 12 12" fill="none">
            <path d="M6 0C4.40887 0 2.88274 0.632146 1.75707 1.75707C0.632078 2.88261 0 4.40887 0 6C0 7.59113 0.632146 9.11726 1.75707 10.2429C2.88261 11.3679 4.40887 12 6 12C7.59113 12 9.11726 11.3679 10.2429 10.2429C11.3679 9.11739 12 7.59113 12 6C11.9984 4.40942 11.3657 2.88425 10.2407 1.75927C9.11575 0.634286 7.59058 0.00164571 6 0ZM6 11.1429C4.63607 11.1429 3.32791 10.6013 2.36352 9.63648C1.39869 8.6722 0.857143 7.36402 0.857143 6C0.857143 4.63598 1.39875 3.32791 2.36352 2.36352C3.3278 1.39869 4.63598 0.857143 6 0.857143C7.36402 0.857143 8.67209 1.39875 9.63648 2.36352C10.6013 3.3278 11.1429 4.63598 11.1429 6C11.1412 7.36339 10.5991 8.67058 9.63483 9.63483C8.67056 10.5991 7.36347 11.1412 6 11.1429ZM6.42857 2.14286V5.6448C6.42964 5.98605 6.29411 6.31337 6.05196 6.55391L4.16035 8.44552V8.44605C3.99213 8.60838 3.72481 8.6057 3.55928 8.4407C3.39429 8.27516 3.3916 8.00785 3.55392 7.83963L5.44554 5.94802H5.44607C5.52643 5.86766 5.57143 5.75837 5.57143 5.64481V2.14286C5.57143 1.90607 5.76321 1.71429 6 1.71429C6.23679 1.71429 6.42857 1.90607 6.42857 2.14286Z" fill="#2E2E2E"/>
          </svg>

          {new Date(featuredPost.date).toLocaleDateString("en-US", {
            weekday: "long",
            day: "numeric",
            month: "short",
          })}
        </span>
      </div>
    </div>
  )}
</div>


      

 <div data-reveal class="fade-up w-full flex flex-col md:flex-row md:w-12/12 lg:w-4/12 md:pl-6 md:pt-0 pt-10 pl-0 relative hidden sm:block">
        <div class="orange-dashed gorder-height-40 absolute left-[-12px] top-0 border-l-2 border-dashed border-[#F58220] hidden lg:block"></div>
        <div class="w-full">
          <div class="blog_list">
       {blogPosts.map(post => {
  const readTime = getReadingTime(post.blog?.description);
const pdfUrl = post.blog?.uploadPdf?.node?.mediaItemUrl;
const detailUrl = `/blog/${post.slug}`; 

const link = pdfUrl ? pdfUrl : detailUrl;
  return (
                <a href={link} target="_blank"><div key={post.id} class="blog_card flex gap-4 mb-[30px]">
                <div class="blog_image w-[110px] shrink-0">
                  <img src={post.featuredImage?.node?.sourceUrl ?? "/blo_thumb.png"} class="w-full h-auto object-cover min-h-[110px]" />
                </div>
                <div class="blog_body flex flex-col items-start justify-center">
                  <span class="text-sm gradient-text">
                    {post.categories.edges[0]?.node?.name ?? "Report"} | {readTime}
                  </span>
                  <p class="pt-[10px]">{
                        post.title
                          ? post.title.length > 60
                            ? post.title.substring(0, 60) + "..."
                            : post.title
                          : ""
                      }</p>
                  <span class="blog_date pt-[10px] flex gap-2 text-sm items-center">
                    <svg width="12" height="12" viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <path d="M6 0C4.40887 0 2.88274 0.632146 1.75707 1.75707C0.632078 2.88261 0 4.40887 0 6C0 7.59113 0.632146 9.11726 1.75707 10.2429C2.88261 11.3679 4.40887 12 6 12C7.59113 12 9.11726 11.3679 10.2429 10.2429C11.3679 9.11739 12 7.59113 12 6C11.9984 4.40942 11.3657 2.88425 10.2407 1.75927C9.11575 0.634286 7.59058 0.00164571 6 0ZM6 11.1429C4.63607 11.1429 3.32791 10.6013 2.36352 9.63648C1.39869 8.6722 0.857143 7.36402 0.857143 6C0.857143 4.63598 1.39875 3.32791 2.36352 2.36352C3.3278 1.39869 4.63598 0.857143 6 0.857143C7.36402 0.857143 8.67209 1.39875 9.63648 2.36352C10.6013 3.3278 11.1429 4.63598 11.1429 6C11.1412 7.36339 10.5991 8.67058 9.63483 9.63483C8.67056 10.5991 7.36347 11.1412 6 11.1429ZM6.42857 2.14286V5.6448C6.42964 5.98605 6.29411 6.31337 6.05196 6.55391L4.16035 8.44552V8.44605C3.99213 8.60838 3.72481 8.6057 3.55928 8.4407C3.39429 8.27516 3.3916 8.00785 3.55392 7.83963L5.44554 5.94802H5.44607C5.52643 5.86766 5.57143 5.75837 5.57143 5.64481V2.14286C5.57143 1.90607 5.76321 1.71429 6 1.71429C6.23679 1.71429 6.42857 1.90607 6.42857 2.14286Z" fill="#2E2E2E"/>
                    </svg>
                    {new Date(post.date).toLocaleDateString("en-US", { weekday: "long", day: "numeric", month: "short" })}
                  </span>
                </div>
              </div>
              </a>
              );
            })}
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<style nonce={nonce}>
  .contact_cta2 {
    padding: 10px 30px;
    display: flex;
    font-size: 14px;
  }
  .left_dashed_board {
    border-left: dashed 1px #f58220;
  }
  .orange-dashed.gorder-height-40 {
        height: calc(100% - 25px);
  }
  @media (max-width: 768px) {
  .contact_cta2 {
    display: none;
  }
}
</style>